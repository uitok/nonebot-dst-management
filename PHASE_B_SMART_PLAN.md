# nonebot-plugin-dst-management 优化计划 - Phase B (Smart) 开发计划

## 目标
实现“会话锁定”与“模糊指令匹配”，减少用户输入冗余，提升交互的自然度与便捷性。

## 详细任务清单

### 1. 会话锁定机制 (Session Locking / Context Awareness)
- **记忆最近操作**：在数据库或内存中记录每个用户/群组最近操作成功的房间 ID（Last Operated Room）。
- **参数省略支持**：
    - 修改所有需要房间 ID 的指令（如 `dst start`, `dst stop`, `dst players`）。
    - 当用户省略房间 ID 参数时，自动调用“最近操作记录”。
    - 如果没有记录，再提示用户提供房间 ID。
- **持久化**：将 `last_room_id` 存储在 `user_settings` 或 `group_settings` 中。

### 2. 模糊命令匹配与容错 (Fuzzy Matching)
- **别名库扩充**：利用 Phase A 中建立的别名机制，进一步扩充口语化指令（如：`踢人`, `关服`, `谁在玩`）。
- **自然语言前缀**：支持简单的自然语言前缀处理，例如允许 `请帮我[命令]` 或 `小安[命令]` 触发。
- **参数智能识别**：尝试从复杂的输入中提取房间名或玩家名，而不依赖严格的参数位置。

### 3. 操作确认与回馈 (Smart Feedback)
- **智能确认**：当使用会话锁定的房间时，在反馈中明确告知：“[操作中] 🌟 正在为您操作上次访问的【龙鳞炉】房间...”。

## 实施步骤
1. **扩展数据库模型**：在 `user_settings` 中增加 `last_room_id` 字段。
2. **重构 `resolve_room_id` 逻辑**：将其升级为支持上下文感知的智能解析器。
3. **全局更新 Handler**：应用新的解析器。
4. **增强别名匹配逻辑**。
5. **编写场景测试**：验证在省略参数时是否能正确回溯到上次操作的房间。
